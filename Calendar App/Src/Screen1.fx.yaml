Screen1 As screen:
    OnVisible: =

    Container3 As groupContainer.manualLayoutContainer:
        Fill: =RGBA(50, 86, 160, 1)
        Height: =87
        Width: =1366
        ZIndex: =1

        Label10_1 As label:
            Color: =RGBA(255, 255, 255, 1)
            Height: =87
            Size: =25
            Text: |
                =If(
                    IsBlank(ComboBox1.Selected),
                    "Select a user...",
                    ComboBox1.Selected.DisplayName & " (" & ComboBox1.Selected.JobTitle & ")"
                )
            Width: =773
            X: =88
            ZIndex: =2

        Label12 As label:
            Align: =Align.Right
            Color: =RGBA(255, 255, 255, 1)
            Height: =87
            Size: =18
            Text: |
                =If(
                    IsBlank(ComboBox1.Selected),
                    "City",
                    ComboBox1.Selected.OfficeLocation & " (" & ComboBox1.Selected.Department & ")"
                )
            Width: =392
            X: =973
            ZIndex: =3

        Image1 As image:
            Height: =99
            Image: ='924291258'
            ImagePosition: =ImagePosition.Fill
            Width: =88
            ZIndex: =4

    Email_Label As label:
        FontWeight: =FontWeight.Semibold
        Height: =36
        Size: =20
        Text: ="Email Address"
        Width: =240
        X: =617
        Y: =103
        ZIndex: =2

    Form_Container As groupContainer.manualLayoutContainer:
        Fill: =RGBA(175, 191, 224, 1)
        Height: =612
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Width: =541
        Y: =156
        ZIndex: =4

        Date_Label_1 As label:
            FontWeight: =FontWeight.Semibold
            Size: =15
            Text: ="Date"
            X: =24
            Y: =194
            ZIndex: =1

        Department_Label As label:
            FontWeight: =FontWeight.Semibold
            Size: =15
            Text: ="Department"
            X: =24
            Y: =103
            ZIndex: =2

        Slots_Label As label:
            FontWeight: =FontWeight.Semibold
            Size: =15
            Text: ="Available Slots"
            X: =24
            Y: =284
            ZIndex: =5

        Input_Slots As dropdown:
            Height: =44
            Items: |-
                =    ["12:00 AM - 1:00 AM", "1:00 AM - 2:00 AM", "2:00 AM - 3:00 AM", "3:00 AM - 4:00 AM", "4:00 AM - 5:00 AM", "5:00 AM - 6:00 AM", 
                     "6:00 AM - 7:00 AM", "7:00 AM - 8:00 AM", "8:00 AM - 9:00 AM", "9:00 AM - 10:00 AM", "10:00 AM - 11:00 AM", "11:00 AM - 12:00 PM", 
                     "12:00 PM - 1:00 PM", "1:00 PM - 2:00 PM", "2:00 PM - 3:00 PM", "3:00 PM - 4:00 PM", "4:00 PM - 5:00 PM", "5:00 PM - 6:00 PM", 
                     "6:00 PM - 7:00 PM", "7:00 PM - 8:00 PM", "8:00 PM - 9:00 PM", "9:00 PM - 10:00 PM", "10:00 PM - 11:00 PM", "11:00 PM - 12:00 AM"]
            OnChange: |
                =
                
                Set(MaxAppointments, 5);
                // Assuming the selected value is in the format "12:00 AM - 1:00 AM"
                // Split the string into a start and end time
                // Assuming the dropdown's name is DropdownAvailableSlots
                //If(
                //    !IsBlank(Input_Slots.Selected.Value),
                //    Set(varStartTime, Trim(Left(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) - 1))),
                 //   Set(varEndTime, Trim(Mid(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) + 3)))
                //)
                
                
                
                //Set(slots,If(New_AppointmentsX,StartTime=StartTime,Count) >=MaxAppointments);
                
                //Set(
                 //   AppointmentsLeft,
                   // 5 - LookUp(AppointmentCounts,EndTime = StartTime, Count)
                //);
                // Counts bookings for the selected slot
                Set(varCurrentBookings, CountRows(Filter(New_AppointmentsX, Start_Time = Trim(Left(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) - 1)))));
            OnSelect: |
                =
            Width: =489
            X: =24
            Y: =324
            ZIndex: =6

        Input_Location As dropdown:
            Items: =["New Jersey","Colarado","Texas"]
            Width: =489
            X: =24
            Y: =53
            ZIndex: =7

        Input_Date As datepicker:
            Width: =489
            X: =24
            Y: =234
            ZIndex: =8

        Slots_Left_Label As label:
            FontWeight: =FontWeight.Semibold
            Height: =49
            Size: =15
            Text: |-
                ="Total Bookings:"
            Width: =171
            X: =44
            Y: =403
            ZIndex: =9

        Input_Department As dropdown:
            Default: =First(colAppointmentDetails).Department_Name.Value
            Items: =["Cardiology","Pathology","Surgery"]
            Width: =489
            X: =24
            Y: =143
            ZIndex: =11

        Location_Label As label:
            FontWeight: =FontWeight.Semibold
            Size: =15
            Text: ="Location"
            X: =24
            Y: =13
            ZIndex: =12

        Submit_Button As button:
            Height: =43
            OnSelect: |+
                = Set(varStartTime, Trim(Left(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) - 1)));
                Set(varEndTime, Trim(Mid(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) + 3)));
                
                Patch(New_AppointmentsX,{Appointment_Date:Input_Date.SelectedDate,Email:ComboBox1.Selected.Mail,Department_Name:Input_Department.SelectedText,Start_Time:varStartTime,End_Time:varEndTime,Location:Input_Location.SelectedText});
                //Email_confirmation.Run(ComboBox1.Selected.Mail,Input_Location.Selected.Value,Input_Department.Selected.Value,Text(Input_Date.SelectedDate, "MM-dd-yyyy"),Input_Slots.Selected.Value)
                Email_Confirmer.Run(ComboBox1.Selected.Mail,Input_Location.Selected.Value,Input_Department.Selected.Value,Text(Input_Date.SelectedDate,"MM-dd-yyyy"),varStartTime,varEndTime)
                
                
            Text: ="Submit"
            Width: =135
            X: =349
            Y: =495
            ZIndex: =13

        Label8 As label:
            DisplayMode: =DisplayMode.View
            Height: =39
            Size: =15
            Text: =varCurrentBookings
            Width: =42
            X: =198
            Y: =408
            ZIndex: =14

        Slots_Left_Label_1 As label:
            FontWeight: =FontWeight.Semibold
            Height: =49
            Size: =15
            Text: |-
                ="Remaining Bookings:"
            Width: =214
            X: =240
            Y: =403
            ZIndex: =15

        Label8_1 As label:
            DisplayMode: =DisplayMode.View
            Height: =39
            Size: =15
            Text: =5-varCurrentBookings
            Width: =36
            X: =448
            Y: =408
            ZIndex: =16

        Submit_Button_1 As button:
            Height: =43
            OnSelect: |-
                =// Set start and end times from the selected slot
                Set(varStartTime, Trim(Left(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) - 1)));
                Set(varEndTime, Trim(Mid(Input_Slots.Selected.Value, Find(" -", Input_Slots.Selected.Value) + 3)));
                
                // Check for existing bookings
                If(
                    IsEmpty(
                        Filter(
                            New_AppointmentsX,
                            Appointment_Date = Input_Date.SelectedDate,
                            Start_Time = varStartTime,
                            End_Time = varEndTime
                        )
                    ),
                    // If no conflicts, patch a new appointment
                    Patch(
                        New_AppointmentsX,
                        Defaults(New_AppointmentsX),
                        {
                            Appointment_Date: Input_Date.SelectedDate,
                            Email: ComboBox1.Selected.Mail,
                            Department_Name: Input_Department.SelectedText,
                            Start_Time: varStartTime,
                            End_Time: varEndTime,
                            Location: Input_Location.SelectedText
                        }
                    ),
                    // Optional: Notify user of the conflict
                    Notify("This time slot is already booked.", NotificationType.Error)
                );
                Email_Confirmer.Run(ComboBox1.Selected.Mail,Input_Location.Selected.Value,Input_Department.Selected.Value,Text(Input_Date.SelectedDate,"MM-dd-yyyy"),varStartTime,varEndTime)
            Text: ="Submit"
            Width: =176
            X: =39
            Y: =554
            ZIndex: =17

    Calendar_Container As groupContainer.manualLayoutContainer:
        Fill: =RGBA(175, 191, 224, 1)
        Height: =612
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Width: =823
        X: =541
        Y: =156
        ZIndex: =5

        "WeekdaysGallery As gallery.'BrowseLayout_Vertical_OneTextVariant_ver5.0'":
            DelayItemLoading: =true
            Fill: =RGBA(50, 86, 160, 1)
            Height: =41
            Items: =Calendar.WeekdaysShort()
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            ShowScrollbar: =false
            TemplatePadding: =0
            TemplateSize: =61
            Width: =823
            WrapCount: =7
            X: =2
            Y: =89
            ZIndex: =1

            Title8 As label:
                Align: =Align.Center
                Color: =RGBA(255, 255, 255, 1)
                FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                Height: =19
                OnSelect: =Select(Parent)
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =ThisItem.Value
                VerticalAlign: =VerticalAlign.Top
                Width: =60
                X: =26
                Y: =10
                ZIndex: =1

        "DatesGallary As gallery.'BrowseLayout_Vertical_OneTextVariant_ver5.0'":
            DelayItemLoading: =true
            Height: =484
            Items: |
                =ForAll(Sequence(42),Value+varCurrentDate-Weekday(varCurrentDate))
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            ShowScrollbar: =false
            TemplatePadding: =0
            TemplateSize: =80
            Width: =823
            WrapCount: =7
            X: =1
            Y: =128
            ZIndex: =1

            Date_Display As label:
                Align: =Align.Center
                BorderColor: =RGBA(237, 237, 237, 1)
                BorderThickness: =0.5
                Color: |-
                    =If(
                        Month(ThisItem.Value) <> Month(varCurrentDate),
                        ColorFade(
                            Self.Fill, 
                            -15% 
                        ), 
                        RGBA( 
                            0, 
                            0, 
                            0, 
                            1 
                        )
                    )
                Fill: |-
                    =If(
                        ThisItem.Value = Today(),
                        ColorFade(
                            RGBA(
                                58,
                                150,
                                221,
                                1
                            ),
                            80%
                        ),
                        RGBA(
                            255,
                            255,
                            255,
                            255
                        )
                    )
                    //If(
                        //CountRows(Filter(New_AppointmentsX,Appointment_Date=ThisItem.Value)) > 5,
                       // RGBA(0,255,0,1)
                        //),
                        //)RGBA(
                          //  255,
                            //255,
                            //255,
                            //255
                        //)
                        //)
                FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                Height: =Parent.TemplateHeight
                HoverColor: = ColorValue("Black")
                LineHeight: =2
                OnSelect: =Select(Parent)
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Day(ThisItem.Value)
                VerticalAlign: =VerticalAlign.Top
                Width: =Parent.TemplateWidth
                ZIndex: =1

            Date As label:
                Align: =Align.Center
                Fill: =RGBA(39,113 , 194, 0)
                Height: =80
                HoverColor: =RGBA(153, 207, 236, 1)
                HoverFill: =RGBA(39,113,194,0.5)
                OnSelect: |+
                    =//Notify("Touch");
                    //Set(Date_click,ThisItem.Value);
                    
                    Set(varSelectedDate,Date_Display.Text);  //Date_Display.Text
                    Set(varclick_date,ThisItem.Value);
                    Collect(
                        colAppointmentDetails,
                        LookUp(New_AppointmentsX, Appointment_Date=varclick_date).Appointment_Date //Appointment_Date=Date(varSelectedDate)
                    );
                    //Notify(ThisItem.Value);
                    Notify(LookUp(New_AppointmentsX, Appointment_Date=varclick_date && Email=Text("rdayasaagar@gmail.com")).Email);
                    //Notify(DateValue(varSelectedDate));
                    //Notify(First(colAppointmentDetails).Appointment_Date)
                    
                Text: =
                Width: =117
                ZIndex: =2

            "AppointmentsGallery As gallery.'BrowseLayout_Vertical_OneTextVariant_ver5.0'":
                DelayItemLoading: =true
                Height: =80
                Items: |-
                    =//Filter(New_AppointmentsX,Email=Input_Email.Text,Appointment_Date=ThisItem.Value)
                    Filter(New_AppointmentsX,Email=ComboBox1.Selected.Mail,Appointment_Date=ThisItem.Value)
                Layout: =Layout.Vertical
                LoadingSpinner: =LoadingSpinner.Data
                TemplatePadding: =0
                TemplateSize: =15
                Width: =117.57142857142856
                ZIndex: =3

                Button2 As button:
                    Fill: =RGBA(RandBetween(1, 255), RandBetween(1, 255), RandBetween(1, 255), 1)
                    FontWeight: =FontWeight.Bold
                    Height: =16
                    OnSelect: |-
                        =//Input_Department.SelectedText=ThisItem.Department_Name;
                        
                        //Set(varSelectedDate, ThisItem.Value);
                        Collect(
                            colAppointmentDetails,
                            LookUp(New_AppointmentsX, Appointment_Date=ThisItem.Appointment_Date)
                        );
                        
                        
                        Set(varShowPopUptwo,true);
                        Set(date_dp,ThisItem.Appointment_Date);
                        Set(location_dp,ThisItem.Location.Value);
                        Set(slot_dp,ThisItem.Start_Time & "-" & ThisItem.End_Time);
                        Set(department_dp,ThisItem.Department_Name.Value)
                    Size: =9
                    Text: =ThisItem.Start_Time & "-" & ThisItem.End_Time
                    Width: =117.57142857142856
                    Y: =30
                    ZIndex: =2

        MonthYearLabel As label:
            Align: =Align.Center
            Color: =RGBA(255, 255, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =51
            Size: =30
            Text: =Text(varCurrentDate,"mmmm yyyy")
            Width: =270
            X: =278
            Y: =18
            ZIndex: =2

        PreviousButton As button:
            BorderColor: =
            BorderThickness: =0
            Fill: =RGBA(175, 191, 224, 1)
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =89
            OnSelect: |-
                =Set(
                    varCurrentDate,
                    Date( 
                        Year(varCurrentDate),
                        Month(varCurrentDate)-1,
                        1
                    )
                )
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Size: =45
            Text: ="<"
            Width: =82
            X: =661
            ZIndex: =3

        NextButton As button:
            BorderColor: =
            BorderThickness: =0
            Fill: =RGBA(175, 191, 224, 1)
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =89
            OnSelect: |-
                =Set(
                    varCurrentDate,
                    Date( 
                        Year(varCurrentDate),
                        Month(varCurrentDate)+1,
                        1
                    )
                )
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Size: =45
            Text: =">"
            Width: =82
            X: =743
            ZIndex: =4

        TodayButton As button:
            Fill: =RGBA(50, 86, 160, 1)
            Height: =30
            OnSelect: |+
                =Set(
                    varCurrentDate,
                    Date( 
                        Year(Today()),
                        Month(Today()),
                        1
                    )
                )
                
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Text: ="Today"
            Width: =87
            X: =20
            Y: =33
            ZIndex: =5

    Button4 As button:
        Height: =44
        OnSelect: =Set(varShowPopUp,true)
        Text: ="Change department"
        Width: =212
        X: =42
        Y: =651
        ZIndex: =6

    Radio2 As radio:
        Default: ="Others"
        Height: =66
        Items: =["Yours","Others"]
        Layout: =Layout.Horizontal
        OnChange: =Reset(ComboBox1)
        RadioSize: =30
        Width: =264
        X: =324
        Y: =98
        ZIndex: =7

    ComboBox1 As combobox:
        DefaultSelectedItems: |-
            =If(
              Radio2.Selected.Value = "Yours",
              Office365Users.MyProfile(),
              Blank()
            )
        DisplayFields: =["Mail","DisplayName"]
        DisplayMode: =If(Radio2.Selected.Value = "Yours", DisplayMode.View, DisplayMode.Edit)
        Height: =36
        Items: |-
            =//Office365Users.SearchUser({searchTerm: ComboBox1.SearchText})
            Filter(
                Office365Users.SearchUser({searchTerm: ComboBox1.SearchText}),
                 "@valuemomentum.com" in Mail 
            )
        SearchFields: =["DisplayName","Mail"]
        SearchItems: |-
            =Search(//Office365Users.SearchUser({searchTerm: ComboBox1.SearchText})
            Filter(
                Office365Users.SearchUser({searchTerm: ComboBox1.SearchText}),
                 "@valuemomentum.com" in Mail 
            ),ComboBox1.SearchText,DisplayName,Mail)
        SelectMultiple: =false
        Template: =ListItemTemplate.Double
        Width: =434
        X: =851
        Y: =103
        ZIndex: =8

    Group3 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =20

        PopUp_Transition As rectangle:
            Fill: =RGBA(56, 96, 178, 0.5)
            Height: =768
            Visible: =varShowPopUp
            Width: =1366
            ZIndex: =9

        PopUp_Window As rectangle:
            BorderColor: =RGBA(255, 255, 255, 1)
            Fill: =RGBA(255, 255, 255, 1)
            Height: =390
            Visible: =varShowPopUp
            Width: =726
            X: =288
            Y: =168
            ZIndex: =10

        PopUp_Title_Bar As label:
            Align: =Align.Center
            Fill: =RGBA(255, 191, 0, 1)
            Text: ="Edit Form"
            Visible: =varShowPopUp
            Width: =726
            X: =288
            Y: =128
            ZIndex: =11

        Label_You_Info As label:
            Align: =Align.Center
            Height: =36
            Text: ="Enter Information"
            Visible: =varShowPopUp
            Width: =474
            X: =386
            Y: =174
            ZIndex: =12

        Label_Email_PopUp_Label As label:
            Text: ="Email"
            Visible: =varShowPopUp
            X: =323
            Y: =225
            ZIndex: =13

        Label_Dropdown_PopUp As label:
            Text: ="Department"
            Visible: =varShowPopUp
            X: =315
            Y: =309
            ZIndex: =14

        Dropdown_PopUp As dropdown:
            Items: =["Cardiology","Pathology","Surgery"]
            Visible: =varShowPopUp
            X: =465
            Y: =309
            ZIndex: =15

        Continue_Btn_PopUp As button:
            Fill: =RGBA(152, 208, 70, 1)
            OnSelect: |
                =// Update the record in the SharePoint list
                Patch(
                    New_AppointmentsX, // Your SharePoint list name
                    LookUp(New_AppointmentsX, Email = Value(TextInput3.Text)), // Find the record by Email
                    {
                        Department_Name: Dropdown_PopUp.SelectedText // Update the Department field
                    }
                );
                
                // Optional: Notify the user about the update
                Notify("Record updated successfully!", NotificationType.Success);
            Text: ="Continue"
            Visible: =varShowPopUp
            X: =713
            Y: =457
            ZIndex: =16

        Cancel_Btn_PopUp As button:
            Fill: =RGBA(255, 0, 0, 1)
            OnSelect: =Set(varShowPopUp,false);
            Text: ="Cancel"
            Visible: =varShowPopUp
            X: =427
            Y: =457
            ZIndex: =17

        TextInput3 As text:
            Default: =
            OnChange: |-
                =Set(Email,TextInput3.Text);
                ClearCollect(
                    FilteredAppointments,
                    LookUp(New_AppointmentsX, Email=Email)
                );
            Visible: =varShowPopUp
            X: =469
            Y: =224
            ZIndex: =18

    PopUpGroup As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =32

        Rectangle2 As rectangle:
            Fill: =RGBA(56, 96, 178, 0.5)
            Height: =768
            Visible: =varShowPopUptwo
            Width: =1364
            ZIndex: =19

        Rectangle5 As rectangle:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =324
            Visible: =varShowPopUptwo
            Width: =512
            X: =408
            Y: =210
            ZIndex: =20

        Label3 As label:
            Align: =Align.Center
            Fill: =RGBA(255, 191, 0, 1)
            Height: =42
            Text: ="Appointment Information"
            Visible: =varShowPopUptwo
            Width: =512
            X: =408
            Y: =168
            ZIndex: =21

        Button1 As button:
            Fill: =RGBA(255, 0, 0, 1)
            OnSelect: =Set(varShowPopUptwo,false)
            Text: ="Close"
            Visible: =varShowPopUptwo
            X: =584
            Y: =467
            ZIndex: =22

        Label9 As label:
            FontWeight: =FontWeight.Bold
            Text: ="User Name"
            Visible: =varShowPopUptwo
            X: =465
            Y: =231
            ZIndex: =23

        Label9_1 As label:
            Height: =39
            Text: =ComboBox1.Selected.DisplayName
            Visible: =varShowPopUptwo
            Width: =281
            X: =628
            Y: =232
            ZIndex: =24

        Label9_2 As label:
            FontWeight: =FontWeight.Bold
            Text: ="Slot Booked"
            Visible: =varShowPopUptwo
            X: =465
            Y: =399
            ZIndex: =25

        Label9_3 As label:
            Text: |-
                =//First(colAppointmentDetails).Start_Time 
                slot_dp
            Visible: =varShowPopUptwo
            Width: =220
            X: =628
            Y: =399
            ZIndex: =26

        Label9_4 As label:
            Text: =date_dp
            Visible: =varShowPopUptwo
            X: =628
            Y: =361
            ZIndex: =27

        Label9_5 As label:
            FontWeight: =FontWeight.Bold
            Text: ="Date"
            Visible: =varShowPopUptwo
            X: =465
            Y: =360
            ZIndex: =28

        Label9_6 As label:
            FontWeight: =FontWeight.Bold
            Text: ="Location"
            Visible: =varShowPopUptwo
            X: =465
            Y: =274
            ZIndex: =29

        Label9_7 As label:
            Text: |-
                =//First(colAppointmentDetails).Start_Time 
                location_dp
            Visible: =varShowPopUptwo
            X: =628
            Y: =276
            ZIndex: =30

        Label9_8 As label:
            Text: |-
                =//First(colAppointmentDetails).Start_Time 
                department_dp
            Visible: =varShowPopUptwo
            X: =628
            Y: =320
            ZIndex: =31

        Label9_9 As label:
            FontWeight: =FontWeight.Bold
            Text: ="Department"
            Visible: =varShowPopUptwo
            X: =465
            Y: =316
            ZIndex: =32

    Label10 As label:
        Text: ="Whose appointment are you editing?"
        Width: =321
        X: =17
        Y: =103
        ZIndex: =34

